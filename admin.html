<!DOCTYPE html>
<html>
<head>
    <title>–ê–¥–º—ñ–Ω–∫–∞ –†–æ–∑–∫–ª–∞–¥—É v2.0</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: #f0f2f5; }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab-btn { padding: 10px 20px; cursor: pointer; border: none; background: none; font-size: 16px; font-weight: bold; color: #666; }
        .tab-btn.active { color: #007bff; border-bottom: 3px solid #007bff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* –°—Ç–∏–ª—ñ —Ñ–æ—Ä–º–∏ */
        .form-container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: 1 / -1; }
        
        label { font-size: 12px; color: #555; font-weight: bold; margin-bottom: 2px; display: block; }
        select, input { padding: 10px; width: 100%; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 14px; }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn-save { background: #28a745; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-size: 16px; margin-top: 10px; width: 100%; }
        .btn-save:hover { background: #218838; }
        .btn-cancel { background: #6c757d; display: none; margin-top: 10px; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; width: 100%; }

        /* –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ–∫ */
        .card-item { background: white; border-left: 5px solid #007bff; margin-top: 15px; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .actions button { margin-left: 5px; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-edit { background: #ffc107; color: #333; }
        .btn-delete { background: #dc3545; color: white; }

        /* –¢–∞–±–ª–∏—Ü—è */
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; margin-top: 15px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #007bff; color: white; }
        tr:hover { background-color: #f1f1f1; }
    </style>
</head>
<body>

    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1>üéì –ö–µ—Ä—É–≤–∞–Ω–Ω—è –†–æ–∑–∫–ª–∞–¥–æ–º</h1>
        <div style="font-size: 14px; color: #666;">–°—Ç–∞—Ç—É—Å: <span id="status" style="color:green">‚óè –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ</span></div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('editor')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä</button>
        <button class="tab-btn" onclick="openTab('table-view')">üìä –ü–æ–≤–Ω–∞ –¢–∞–±–ª–∏—Ü—è</button>
    </div>

    <div id="editor" class="tab-content active">
        <div class="form-container">
            <input type="hidden" id="edit-id">

            <div>
                <label>–ê—É–¥–∏—Ç–æ—Ä—ñ—è</label>
                <select id="auditorium">
                    <option value="2">–ê—É–¥–∏—Ç–æ—Ä—ñ—è 2</option>
                    <option value="10">–ê—É–¥–∏—Ç–æ—Ä—ñ—è 10</option>
                </select>
            </div>

            <div>
                <label>–î–µ–Ω—å —Ç–∏–∂–Ω—è</label>
                <select id="day">
                    <option value="1">–ü–æ–Ω–µ–¥—ñ–ª–æ–∫</option>
                    <option value="2">–í—ñ–≤—Ç–æ—Ä–æ–∫</option>
                    <option value="3">–°–µ—Ä–µ–¥–∞</option>
                    <option value="4">–ß–µ—Ç–≤–µ—Ä</option>
                    <option value="5">–ü'—è—Ç–Ω–∏—Ü—è</option>
                    <option value="6">–°—É–±–æ—Ç–∞</option>
                </select>
            </div>

            <div>
                <label>–ß–∞—Å –ø–æ—á–∞—Ç–∫—É</label>
                <select id="time">
                    <option value="08:20">08:20 (1 –ø–∞—Ä–∞)</option>
                    <option value="09:50">09:50 (2 –ø–∞—Ä–∞)</option>
                    <option value="11:40">11:40 (3 –ø–∞—Ä–∞)</option>
                    <option value="13:10">13:10 (4 –ø–∞—Ä–∞)</option>
                    <option value="14:40">14:40 (5 –ø–∞—Ä–∞)</option>
                    <option value="16:10">16:10 (6 –ø–∞—Ä–∞)</option>
                </select>
            </div>

            <div>
                <label>–ì—Ä—É–ø–∞</label>
                <select id="group">
                    <option value="–ö–ù-22">–ö–ù-22</option>
                    <option value="–ö–ù-25">–ö–ù-25</option>
                    <option value="–ú–ì-21">–ú–ì-21</option>
                </select>
            </div>

            <div class="full-width">
                <label>–ü—Ä–µ–¥–º–µ—Ç (4 –∫—É—Ä—Å)</label>
                <select id="subject">
                    <option value="">-- –û–±–µ—Ä—ñ—Ç—å –ø—Ä–µ–¥–º–µ—Ç --</option>
                    <option value="–Ü–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω—ñ —Å–∏—Å—Ç–µ–º–∏">–Ü–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ (–®–Ü)</option>
                    <option value="–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –Ü–¢-–ø—Ä–æ—î–∫—Ç–∞–º–∏">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –Ü–¢-–ø—Ä–æ—î–∫—Ç–∞–º–∏</option>
                    <option value="–ó–∞—Ö–∏—Å—Ç —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó">–ó–∞—Ö–∏—Å—Ç —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ç–∞ –∫—ñ–±–µ—Ä–±–µ–∑–ø–µ–∫–∞</option>
                    <option value="–†–æ–∑—Ä–æ–±–∫–∞ —ñ–≥–æ—Ä (GameDev)">–†–æ–∑—Ä–æ–±–∫–∞ —ñ–≥–æ—Ä (GameDev)</option>
                    <option value="–•–º–∞—Ä–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó">–•–º–∞—Ä–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó</option>
                    <option value="–î–∏–ø–ª–æ–º–Ω–µ –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è">–î–∏–ø–ª–æ–º–Ω–µ –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è</option>
                    <option value="–í–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–∞ Web 3.0">–í–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–∞ Web 3.0</option>
                </select>
            </div>

            <div class="full-width">
                <label>–í–∏–∫–ª–∞–¥–∞—á</label>
                <select id="teacher">
                    <option value="">-- –û–±–µ—Ä—ñ—Ç—å –≤–∏–∫–ª–∞–¥–∞—á–∞ --</option>
                    <option value="–ö–Ω–∏—à—É–∫ –ê.–í.">–ö–Ω–∏—à—É–∫ –ê.–í.</option>
                    <option value="–Ü–∑–≤–∞–ª–æ–≤ –û.–í.">–Ü–∑–≤–∞–ª–æ–≤ –û.–í.</option>
                    <option value="–°—É—Ä–∫–æ–≤ –ö.–Æ.">–°—É—Ä–∫–æ–≤ –ö.–Æ.</option>
                    <option value="–ü–∞—Ä–∞—â—É–∫ –°.–î.">–ü–∞—Ä–∞—â—É–∫ –°.–î.</option>
                    <option value="–ë–æ–Ω–¥–∞—Ä –û. –ü.">–ë–æ–Ω–¥–∞—Ä –û. –ü.</option>
                </select>
            </div>

            <div class="full-width" style="display:flex; gap:10px;">
                <button id="save-btn" class="btn-save" onclick="saveData()">üíæ –î–æ–¥–∞—Ç–∏ –ø–∞—Ä—É</button>
                <button id="cancel-btn" class="btn-cancel" onclick="resetForm()">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>

        <h3>–û—Å—Ç–∞–Ω–Ω—ñ –∑–º—ñ–Ω–∏:</h3>
        <div id="list">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    </div>

    <div id="table-view" class="tab-content">
        <h3>üìÖ –ü–æ–≤–Ω–∏–π —Ä–æ–∑–∫–ª–∞–¥ (Live)</h3>
        <table id="full-schedule-table">
            <thead>
                <tr>
                    <th>–î–µ–Ω—å</th>
                    <th>–ß–∞—Å</th>
                    <th>–ê—É–¥–∏—Ç–æ—Ä—ñ—è</th>
                    <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                    <th>–ì—Ä—É–ø–∞</th>
                    <th>–í–∏–∫–ª–∞–¥–∞—á</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, update, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- –¢–í–Ü–ô –ö–û–ù–§–Ü–ì ---
        const firebaseConfig = {
            apiKey: "AIzaSyDzzIPI2fT_ulFO6-ZJBvo8gzWG0mVhi2k",
            authDomain: "ar-schedule-79f5d.firebaseapp.com",
            databaseURL: "https://ar-schedule-79f5d-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "ar-schedule-79f5d",
            storageBucket: "ar-schedule-79f5d.firebasestorage.app",
            messagingSenderId: "66430771930",
            appId: "1:664307719308:web:627edd401a6e56be1d6fa9"
        };
        // -------------------

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –≤–∫–ª–∞–¥–æ–∫
        window.openTab = function(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            // –ü—ñ–¥—Å–≤—ñ—Ç–∏—Ç–∏ –∫–Ω–æ–ø–∫—É
            event.target.classList.add('active');
        }

        // === –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø (–î–û–î–ê–í–ê–ù–ù–Ø –ê–ë–û –û–ù–û–í–õ–ï–ù–ù–Ø) ===
        window.saveData = function() {
            const id = document.getElementById('edit-id').value; // –Ø–∫—â–æ —Ç—É—Ç —î ID, –∑–Ω–∞—á–∏—Ç—å –º–∏ —Ä–µ–¥–∞–≥—É—î–º–æ
            
            const data = {
                auditorium: document.getElementById('auditorium').value,
                day: parseInt(document.getElementById('day').value),
                time: document.getElementById('time').value,
                subject: document.getElementById('subject').value,
                group: document.getElementById('group').value,
                teacher: document.getElementById('teacher').value
            };

            if(!data.subject || !data.teacher) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!");

            if (id) {
                // –†–ï–ñ–ò–ú –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø
                update(ref(db, 'schedule/' + id), data)
                    .then(() => {
                        alert("‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ!");
                        resetForm();
                    })
                    .catch(e => alert("–ü–æ–º–∏–ª–∫–∞: " + e));
            } else {
                // –†–ï–ñ–ò–ú –°–¢–í–û–†–ï–ù–ù–Ø
                push(ref(db, 'schedule'), data)
                    .then(() => alert("‚úÖ –î–æ–¥–∞–Ω–æ!"))
                    .catch(e => alert("–ü–æ–º–∏–ª–∫–∞: " + e));
            }
        }

        // === –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø (–ó–ê–ü–û–í–ù–ò–¢–ò –§–û–†–ú–£) ===
        window.editPair = function(id, aud, day, time, subj, grp, teach) {
            // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –ø–æ–ª—è
            document.getElementById('edit-id').value = id;
            document.getElementById('auditorium').value = aud;
            document.getElementById('day').value = day;
            document.getElementById('time').value = time;
            document.getElementById('subject').value = subj;
            document.getElementById('group').value = grp;
            document.getElementById('teacher').value = teach;

            // –ó–º—ñ–Ω—é—î–º–æ –∫–Ω–æ–ø–∫–∏
            document.getElementById('save-btn').innerText = "üîÑ –û–Ω–æ–≤–∏—Ç–∏ –ø–∞—Ä—É";
            document.getElementById('save-btn').style.background = "#ffc107";
            document.getElementById('save-btn').style.color = "#333";
            document.getElementById('cancel-btn').style.display = "block";

            // –ü–µ—Ä–µ–º–∏–∫–∞—î–º–æ –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞, —è–∫—â–æ –º–∏ –≤ —Ç–∞–±–ª–∏—Ü—ñ
            openTab('editor');
            document.querySelector('.tab-btn.active').classList.remove('active'); // –ø—Ä–æ—Å—Ç–∏–π —Ñ—ñ–∫—Å UI
            document.querySelector('button[onclick="openTab(\'editor\')"]').classList.add('active');
        }

        // === –°–ö–ê–°–£–í–ê–ù–ù–Ø / –û–ß–ò–©–ï–ù–ù–Ø ===
        window.resetForm = function() {
            document.getElementById('edit-id').value = "";
            document.getElementById('subject').value = "";
            document.getElementById('teacher').value = "";
            
            // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Å—Ç–∏–ª—å –∫–Ω–æ–ø–æ–∫
            document.getElementById('save-btn').innerText = "üíæ –î–æ–¥–∞—Ç–∏ –ø–∞—Ä—É";
            document.getElementById('save-btn').style.background = "#28a745";
            document.getElementById('save-btn').style.color = "white";
            document.getElementById('cancel-btn').style.display = "none";
        }

        // === –í–ò–î–ê–õ–ï–ù–ù–Ø ===
        window.deletePair = function(id) {
            if(confirm('–í–∏ —Ç–æ—á–Ω–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∑–∞–ø–∏—Å?')) {
                remove(ref(db, 'schedule/' + id));
            }
        }

        // === –°–õ–£–•–ê–Ñ–ú–û –î–ê–ù–Ü (LIVE UPDATE) ===
        const listDiv = document.getElementById('list');
        const tableBody = document.querySelector('#full-schedule-table tbody');
        const daysMap = ["", "–ü–æ–Ω–µ–¥—ñ–ª–æ–∫", "–í—ñ–≤—Ç–æ—Ä–æ–∫", "–°–µ—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä", "–ü'—è—Ç–Ω–∏—Ü—è", "–°—É–±–æ—Ç–∞"];

        onValue(ref(db, 'schedule'), (snapshot) => {
            const data = snapshot.val();
            listDiv.innerHTML = "";
            tableBody.innerHTML = "";

            if (data) {
                // –°–æ—Ä—Ç—É—î–º–æ –¥–∞–Ω—ñ (—Å–ø–æ—á–∞—Ç–∫—É –ø–æ –¥–Ω—è—Ö, –ø–æ—Ç—ñ–º –ø–æ —á–∞—Å—É)
                const sortedKeys = Object.keys(data).sort((a,b) => {
                    if (data[a].day !== data[b].day) return data[a].day - data[b].day;
                    return data[a].time.localeCompare(data[b].time);
                });

                sortedKeys.forEach(key => {
                    const p = data[key];
                    
                    // 1. –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ–∫ (–í–∫–ª–∞–¥–∫–∞ Editor)
                    const div = document.createElement('div');
                    div.className = 'card-item';
                    div.innerHTML = `
                        <div>
                            <strong>${daysMap[p.day]} (${p.time})</strong> - –ê—É–¥. ${p.auditorium}<br>
                            ${p.subject} <span style="color:grey">(${p.teacher})</span>
                        </div>
                        <div class="actions">
                            <button class="btn-edit" onclick="editPair('${key}', '${p.auditorium}', '${p.day}', '${p.time}', '${p.subject}', '${p.group}', '${p.teacher}')">‚úèÔ∏è</button>
                            <button class="btn-delete" onclick="deletePair('${key}')">üóëÔ∏è</button>
                        </div>
                    `;
                    listDiv.appendChild(div);

                    // 2. –û–Ω–æ–≤–ª—é—î–º–æ –í–µ–ª–∏–∫—É –¢–∞–±–ª–∏—Ü—é (–í–∫–ª–∞–¥–∫–∞ Table View)
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${daysMap[p.day]}</td>
                        <td>${p.time}</td>
                        <td style="text-align:center"><strong>${p.auditorium}</strong></td>
                        <td>${p.subject}</td>
                        <td>${p.group}</td>
                        <td>${p.teacher}</td>
                    `;
                    tableBody.appendChild(tr);
                });
            } else {
                listDiv.innerHTML = "<p>–ë–∞–∑–∞ –ø–æ—Ä–æ–∂–Ω—è</p>";
                tableBody.innerHTML = "<tr><td colspan='6' style='text-align:center'>–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤</td></tr>";
            }
        });
    </script>
</body>
</html>